/**
 * Pet CSS Animations
 *
 * Defines keyframe animations for each pet state:
 * - idle: slow breathing, occasional blinks
 * - working: tail wag, ear twitch, eyes looking around
 * - completed: bounce, happy eyes
 * - error: worried eyes, ears down
 */

/* Reset for pet window - prevent scroll bars */
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: transparent;
}

/* Base pet container - full width, positioned at bottom */
.pet-container {
  position: absolute;
  bottom: 8px;
  left: 0;
  right: 0;
  cursor: grab;
  overflow: visible;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 8px;
  padding: 0 8px;
}

/* Panel on left (pet on right side of screen) - pet sits on right of window */
.pet-container.pet-panel-left {
  flex-direction: row-reverse;
}

/* Panel on right (pet on left side of screen) - pet sits on left of window */
.pet-container.pet-panel-right {
  flex-direction: row;
}

.pet-container:active {
  cursor: grabbing;
}

/* Pet sprite wrapper - contains sprite and status indicator */
.pet-sprite-wrapper {
  position: relative;
  flex-shrink: 0;
  z-index: 1002; /* Above backdrop (999) and panel (1001) so pet stays visible */
}

/* SVG base styles */
.pet-sprite {
  width: 100%;
  height: 100%;
  transition: transform 0.2s ease;
}

/* GPU acceleration hints for animated elements */
.pet-body,
.pet-eyes,
.pet-tail,
.pet-ears,
.pet-whiskers,
.pet-zzz {
  will-change: transform;
}

/* Pause animations when window loses focus (saves CPU/GPU when minimized) */
.pet-container.paused .pet-body,
.pet-container.paused .pet-eyes,
.pet-container.paused .pet-tail,
.pet-container.paused .pet-ears,
.pet-container.paused .pet-whiskers,
.pet-container.paused .pet-zzz {
  animation-play-state: paused;
}

/* Hover animation on the pet sprite */
.pet-container:hover .pet-sprite {
  animation: hover-wiggle 0.5s ease-in-out;
}

@keyframes hover-wiggle {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
}

/* ============================================================================
   Idle State - Sleeping/Resting
   ============================================================================ */

.pet-state-idle .pet-body {
  animation: idle-breathe 3s ease-in-out infinite;
}

.pet-state-idle .pet-eyes {
  animation: idle-blink 4s ease-in-out infinite;
}

.pet-state-idle .pet-tail {
  animation: idle-tail-sway 4s ease-in-out infinite;
}

.pet-state-idle .pet-zzz {
  animation: idle-zzz 2s ease-in-out infinite;
  opacity: 1;
}

@keyframes idle-breathe {
  0%, 100% { transform: scaleY(1); }
  50% { transform: scaleY(1.02); }
}

@keyframes idle-blink {
  0%, 45%, 55%, 100% { transform: scaleY(1); }
  48%, 52% { transform: scaleY(0.1); }
}

@keyframes idle-tail-sway {
  0%, 100% { transform: rotate(-5deg); }
  50% { transform: rotate(5deg); }
}

@keyframes idle-zzz {
  0%, 100% { opacity: 0.3; transform: translateY(0) scale(0.8); }
  50% { opacity: 1; transform: translateY(-5px) scale(1); }
}

/* ============================================================================
   Working State - Active/Busy
   ============================================================================ */

.pet-state-working .pet-body {
  animation: working-pulse 1s ease-in-out infinite;
}

.pet-state-working .pet-eyes {
  animation: working-look 2s ease-in-out infinite;
}

.pet-state-working .pet-tail {
  animation: working-tail-wag 0.5s ease-in-out infinite;
}

.pet-state-working .pet-ears {
  animation: working-ear-twitch 1.5s ease-in-out infinite;
}

.pet-state-working .pet-zzz {
  opacity: 0;
}

@keyframes working-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

@keyframes working-look {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(2px); }
  75% { transform: translateX(-2px); }
}

@keyframes working-tail-wag {
  0%, 100% { transform: rotate(-15deg); }
  50% { transform: rotate(15deg); }
}

@keyframes working-ear-twitch {
  0%, 20%, 100% { transform: rotate(0deg); }
  10% { transform: rotate(5deg); }
}

/* ============================================================================
   Completed State - Happy/Successful
   ============================================================================ */

.pet-state-completed .pet-body {
  animation: completed-bounce 0.5s ease-in-out 3;
}

.pet-state-completed .pet-eyes {
  animation: completed-happy-eyes 0.8s ease-in-out infinite;
}

.pet-state-completed .pet-tail {
  animation: completed-tail-happy 0.3s ease-in-out infinite;
}

.pet-state-completed .pet-whiskers {
  animation: completed-whiskers 0.5s ease-in-out 3;
}

.pet-state-completed .pet-zzz {
  opacity: 0;
}

@keyframes completed-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes completed-happy-eyes {
  0%, 100% { transform: scaleY(0.8); }
  50% { transform: scaleY(1); }
}

@keyframes completed-tail-happy {
  0%, 100% { transform: rotate(-20deg); }
  50% { transform: rotate(20deg); }
}

@keyframes completed-whiskers {
  0%, 100% { transform: rotate(0deg); }
  50% { transform: rotate(5deg); }
}

/* ============================================================================
   Error State - Worried/Sad
   ============================================================================ */

.pet-state-error .pet-body {
  animation: error-shake 0.5s ease-in-out 3;
}

.pet-state-error .pet-eyes {
  animation: error-worried-eyes 2s ease-in-out infinite;
}

.pet-state-error .pet-tail {
  animation: error-tail-low 2s ease-in-out infinite;
}

.pet-state-error .pet-ears {
  animation: error-ears-down 0.5s ease-out forwards;
}

.pet-state-error .pet-zzz {
  opacity: 0;
}

@keyframes error-shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  75% { transform: translateX(3px); }
}

@keyframes error-worried-eyes {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(1px); }
}

@keyframes error-tail-low {
  0%, 100% { transform: rotate(-10deg) translateY(3px); }
  50% { transform: rotate(0deg) translateY(3px); }
}

@keyframes error-ears-down {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(-15deg); }
}

/* ============================================================================
   Status Indicator
   ============================================================================ */

.pet-status-indicator {
  position: absolute;
  bottom: 2px;
  right: 2px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.pet-status-idle {
  background-color: #9ca3af; /* gray */
}

.pet-status-working {
  background-color: #3b82f6; /* blue */
}

.pet-status-completed {
  background-color: #22c55e; /* green */
}

.pet-status-error {
  background-color: #ef4444; /* red */
}

/* ============================================================================
   Comic Speech Bubble
   ============================================================================ */

.pet-speech-bubble {
  position: relative;
  padding: 6px 10px;
  background-color: #ffffff;
  color: #1a1a1a;
  border-radius: 12px;
  border: 2px solid #1a1a1a;
  font-size: 11px;
  font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', cursive, sans-serif;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
  z-index: 1000;
  white-space: nowrap;
  box-shadow: 2px 2px 0 #1a1a1a;
  transform: scale(0.9);
}

.pet-speech-bubble.visible {
  opacity: 1;
  transform: scale(1);
}

/* Minimal bubble variant */
.pet-bubble-minimal .pet-bubble-status {
  font-size: 11px;
  gap: 4px;
}

.pet-bubble-minimal .pet-bubble-status-icon {
  font-size: 12px;
}

/* Comic bubble tail - hidden for side layout */
.pet-bubble-tail {
  display: none;
}

/* Header with project and branch */
.pet-bubble-header {
  display: flex;
  flex-direction: column;
  gap: 2px;
  margin-bottom: 6px;
  padding-bottom: 6px;
  border-bottom: 2px dotted #ccc;
}

.pet-bubble-project {
  font-weight: 700;
  font-size: 13px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.pet-bubble-branch {
  font-size: 11px;
  color: #666;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Status line */
.pet-bubble-status {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  font-weight: 600;
}

.pet-bubble-status-icon {
  font-size: 14px;
}

.pet-bubble-duration {
  color: #888;
  font-size: 10px;
  font-weight: 400;
  margin-left: 2px;
}

/* Detail lines (tool name, etc.) */
.pet-bubble-detail {
  margin-top: 6px;
  font-size: 11px;
  color: #555;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Error message */
.pet-bubble-error {
  margin-top: 6px;
  padding: 4px 8px;
  background-color: #fee2e2;
  border: 1px solid #ef4444;
  border-radius: 8px;
  font-size: 10px;
  color: #dc2626;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Multiple sessions indicator */
.pet-bubble-sessions {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 2px dotted #ccc;
  font-size: 10px;
  color: #666;
}

/* State-specific bubble colors */
.pet-state-idle .pet-speech-bubble {
  background-color: #f3f4f6;
  border-color: #9ca3af;
  box-shadow: 2px 2px 0 #9ca3af;
}

.pet-state-working .pet-speech-bubble {
  background-color: #eff6ff;
  border-color: #3b82f6;
  box-shadow: 2px 2px 0 #3b82f6;
}

.pet-state-completed .pet-speech-bubble {
  background-color: #f0fdf4;
  border-color: #22c55e;
  box-shadow: 2px 2px 0 #22c55e;
}

.pet-state-error .pet-speech-bubble {
  background-color: #fef2f2;
  border-color: #ef4444;
  box-shadow: 2px 2px 0 #ef4444;
}

/* ============================================================================
   Detail Panel - Full info on click
   ============================================================================ */

/* Backdrop is invisible but catches clicks outside the panel */
.pet-detail-backdrop {
  position: fixed;
  top: -100vh;
  left: -100vw;
  width: 300vw;
  height: 300vh;
  z-index: 1000;
  /* Transparent - just for click catching */
}

/* Panel container - absolutely positioned relative to pet */
.pet-detail-panel-container {
  position: absolute;
  z-index: 1001;
  /* Position will be set by panel-left/panel-right classes */
}

/* Panel on left side of pet */
.pet-panel-left .pet-detail-panel-container {
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-right: 8px;
}

/* Panel on right side of pet */
.pet-panel-right .pet-detail-panel-container {
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-left: 8px;
}

.pet-detail-panel {
  padding: 10px 12px;
  background-color: #ffffff;
  color: #1a1a1a;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  font-size: 11px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  width: 200px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  animation: panel-appear 0.15s ease-out;
}

@keyframes panel-appear {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.pet-detail-close {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 20px;
  height: 20px;
  border: none;
  background: #f3f4f6;
  color: #6b7280;
  border-radius: 50%;
  font-size: 14px;
  line-height: 1;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s, color 0.2s;
}

.pet-detail-close:hover {
  background: #e5e7eb;
  color: #1f2937;
}

.pet-detail-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding-bottom: 10px;
  margin-bottom: 10px;
  border-bottom: 1px solid #e5e7eb;
}

.pet-detail-status-icon {
  font-size: 18px;
}

.pet-detail-status-text {
  font-weight: 600;
  font-size: 13px;
}

.pet-detail-section {
  margin-bottom: 8px;
}

.pet-detail-section:last-of-type {
  margin-bottom: 0;
}

.pet-detail-label {
  font-size: 10px;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}

.pet-detail-value {
  font-size: 12px;
  color: #374151;
  display: flex;
  align-items: center;
  gap: 4px;
}

.pet-detail-icon {
  font-size: 12px;
}

.pet-detail-duration {
  color: #9ca3af;
  font-size: 10px;
  margin-left: 4px;
}

.pet-detail-error {
  background: #fef2f2;
  padding: 8px;
  border-radius: 6px;
  margin: 8px -8px;
}

.pet-detail-error .pet-detail-label {
  color: #dc2626;
}

.pet-detail-error-text {
  color: #dc2626;
  font-size: 11px;
  word-break: break-word;
}

.pet-detail-hint {
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px solid #e5e7eb;
  font-size: 10px;
  color: #9ca3af;
  text-align: center;
}

/* State-specific panel header colors */
.pet-state-idle .pet-detail-panel {
  border-top: 3px solid #9ca3af;
}

.pet-state-working .pet-detail-panel {
  border-top: 3px solid #3b82f6;
}

.pet-state-completed .pet-detail-panel {
  border-top: 3px solid #22c55e;
}

.pet-state-error .pet-detail-panel {
  border-top: 3px solid #ef4444;
}
